"use strict";window.__bridge__||Object.defineProperty(window,"__bridge__",{enumerable:!1,configurable:!1,writable:!1,value:{}}),Object.defineProperty(window.__bridge__,"VP",{enumerable:!1,configurable:!1,writable:!1,value:{__cache:{},store:function(e){const t=Math.random().toString(36);return this.__cache[t]=e,t},batchStore:function(e){let t=this;return e.map(e=>t.store(e))},get:function(e){return this.__cache[e]},remove:function(e){delete this.__cache[e]}}}),Object.defineProperty(window.__bridge__,"CBDispatcher",{enumerable:!1,configurable:!1,writable:!1,value:{__count:0,cache:{},invoke:function(e,...t){window.__bridge__.VP.get(e).apply(this,t)},push:function(e){return window.__bridge__.VP.store(e)},remove:function(e){window.__bridge__.VP.remove(e)}}}),Object.defineProperty(window.__bridge__,"invoke",{enumerable:!1,configurable:!1,writable:!1,value:function(e,...t){let n={};function traverse(obj){if(obj===null||obj===undefined){return obj}if(typeof obj==='function'){return{id:window.__bridge__.CBDispatcher.push(obj)}}if(Array.isArray(obj)){return obj.map(traverse)}if(typeof obj==='object'){return Object.fromEntries(Object.entries(obj).map(([k,v])=>[k,traverse(v)]))}return obj}t.forEach((e,t)=>{n["arg"+t]=traverse(e)});let r=JSON.stringify(n);window.webkit.messageHandlers.bridge.postMessage({identifier:e,args:r})}}),Object.defineProperty(window.__bridge__,"NightMode",{enumerable:!1,configurable:!1,writable:!1,value:{enabled:!1}});const NIGHT_MODE_INVERT_FILTER_CSS="brightness(80%) invert(100%) hue-rotate(180deg)",NIGHT_MODE_STYLESHEET=`html{\n-webkit-filter:hue-rotate(180deg)invert(100%)!important;\n}\niframe,img,video{\n-webkit-filter:${NIGHT_MODE_INVERT_FILTER_CSS}!important;\n}`;var styleElement;function getStyleElement(){return styleElement||((styleElement=document.createElement("style")).type="text/css",styleElement.appendChild(document.createTextNode(NIGHT_MODE_STYLESHEET)),styleElement)}function applyInvertFilterToChildBackgroundImageElements(e){e.querySelectorAll('[style*="background"]').forEach(function(e){(e.style.backgroundImage||"").startsWith("url")&&applyInvertFilterToElement(e)})}function applyInvertFilterToElement(e){invertedBackgroundImageElements.push(e),e.__bridge__NightMode_originalFilter=e.style.webkitFilter,e.style.webkitFilter=NIGHT_MODE_INVERT_FILTER_CSS}function removeInvertFilterFromElement(e){e.style.webkitFilter=e.__bridge__NightMode_originalFilter,delete e.__bridge__NightMode_originalFilter}var invertedBackgroundImageElements=null,observer=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&applyInvertFilterToChildBackgroundImageElements(e)})})});Object.defineProperty(window.__bridge__.NightMode,"setEnabled",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(e!==window.__bridge__.NightMode.enabled){window.__bridge__.NightMode.enabled=e;var t=getStyleElement();if(e)return invertedBackgroundImageElements=[],document.documentElement.appendChild(t),applyInvertFilterToChildBackgroundImageElements(document),void observer.observe(document.documentElement,{childList:!0,subtree:!0});observer.disconnect(),invertedBackgroundImageElements.forEach(removeInvertFilterFromElement);var n=t.parentNode;n&&n.removeChild(t),invertedBackgroundImageElements=null,"rgba(0, 0, 0, 0)"===getComputedStyle(document.documentElement)["background-color"]&&(document.documentElement.style.backgroundColor="#fff")}}}),window.addEventListener("DOMContentLoaded",function(){window.__bridge__.NightMode.setEnabled(window.__bridge__.NightMode.enabled)}),window.__bridge__.CSSInjector||Object.defineProperty(window.__bridge__,"CSSInjector",{enumerable:!1,configurable:!1,writable:!1,value:{}}),window.__bridge__.CSSInjector.inject=function(e){Object.keys(e).forEach(function(t){var n;(n=document.getElementById(t))||((n=document.createElement("style")).type="text/css",n.setAttribute("id",t)),n.innerHTML=e[t],document.getElementsByTagName("head")[0].appendChild(n)})},window.__bridge__.CSSInjector.remove=function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)};
